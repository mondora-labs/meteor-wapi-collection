<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mochawesome Report Card</title>
    <link rel="stylesheet" href="css/mochawesome.css">
  </head>
  <body>
    <!-- NAVBAR -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="report-info-cnt">
          <h1 class="report-title">meteor-wapi-collection</h1>
          <h3 class="report-date">Friday, May 1 2015, 10:56pm</h3>
        </div>
        <div class="quick-summary-cnt">
            <ul class="list-unstyled quick-summary">
              <li class="qs-item summary-duration" title="Duration">273<span>MS</span></li>
              <li class="qs-item summary-suites" title="Suites">23</li>
              <li class="qs-item summary-tests" title="Tests">65</li>
              <li class="qs-item summary-passes" title="Passed" data-filter="passed">65</li>
              <li class="qs-item summary-failures" title="Failed" data-filter="failed">0</li>
              <li class="qs-item summary-pending" title="Pending" data-filter="pending">0</li>
            </ul>        </div>
      </div>
    </div>

    <!-- Report Summary -->
    <div class="summary">
      <div class="container">
          <div class="row">
            <div class="summary-col summary-duration">
              <h1 class="summary-count">273<span>MS</span></h1>
              <h4 class="summary-label">MS</h4>
            </div>
            <div class="summary-col summary-suites" title="Suites">
              <h1 class="summary-count">23</h1>
              <h4 class="summary-label">Suites</h4>
            </div>
            <div class="summary-col summary-tests" title="Tests">
              <h1 class="summary-count">65</h1>
              <h4 class="summary-label">Tests</h4>
            </div>
            <div class="summary-col summary-passes" data-filter="passed" title="Passed">
              <h1 class="summary-count">65</h1>
              <h4 class="summary-label">Passed</h4>
            </div>
            <div class="summary-col summary-failures" data-filter="failed" title="Failed">
              <h1 class="summary-count">0</h1>
              <h4 class="summary-label">Failed</h4>
            </div>
            <div class="summary-col summary-pending" data-filter="pending" title="Pending">
              <h1 class="summary-count">0</h1>
              <h4 class="summary-label">Pending</h4>
            </div>
          </div>      </div>
    </div>
    <div class="statusbar">
      <div class="container">
          <div class="row">
            <div class="status-item status-item-pending-pct">0% Pending</div>
            <div class="status-item status-item-passing-pct success">100% Passing</div>
          </div>      </div>
    </div>

    <!-- Suites -->
    <div class="details container">
            <section class="suite-wrap">
              <div id="e9c9bd6d-6dfe-42d7-9a1c-0c44b0ea72c0" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The addValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/addValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="e9c9bd6d-6dfe-42d7-9a1c-0c44b0ea72c0" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#e9c9bd6d-6dfe-42d7-9a1c-0c44b0ea72c0-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="e9c9bd6d-6dfe-42d7-9a1c-0c44b0ea72c0-test-list" class="list-group test-list collapse in">
                        <div id="5252b4ef-0568-496c-bda8-50bff2a52a32" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should add validation rules to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#5252b4ef-0568-496c-bda8-50bff2a52a32 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [],
                                update: [],
                                remove: []
                            }
                        };
                        <span class="hljs-keyword">var</span> insert = sinon.spy();
                        <span class="hljs-keyword">var</span> update = sinon.spy();
                        <span class="hljs-keyword">var</span> remove = sinon.spy();
                        Collection.prototype.addValidationRules.call(instance, {
                            insert: insert,
                            update: update,
                            remove: remove
                        });
                        instance.validationRules.insert[<span class="hljs-number">0</span>].should.equal(insert);
                        instance.validationRules.update[<span class="hljs-number">0</span>].should.equal(update);
                        instance.validationRules.remove[<span class="hljs-number">0</span>].should.equal(remove);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="4d8fae3e-3174-4190-af88-8cd592dbed31" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return the collection instance to allow method chaining
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4d8fae3e-3174-4190-af88-8cd592dbed31 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [],
                                update: [],
                                remove: []
                            }
                        };
                        <span class="hljs-keyword">var</span> insert = sinon.spy();
                        <span class="hljs-keyword">var</span> update = sinon.spy();
                        <span class="hljs-keyword">var</span> remove = sinon.spy();
                        <span class="hljs-keyword">var</span> ret = Collection.prototype.addValidationRules.call(instance, {});
                        ret.should.equal(instance);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="207c967c-fc64-409a-a171-e682c0493f4d" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The attachMethods method</h3>
                <h5 class="suite-filename">/test/unit/collection/attachMethods.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="207c967c-fc64-409a-a171-e682c0493f4d" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#207c967c-fc64-409a-a171-e682c0493f4d-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="207c967c-fc64-409a-a171-e682c0493f4d-test-list" class="list-group test-list collapse in">
                        <div id="b57f158f-d75a-464e-b97a-71ed9f641602" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should attach methods to the collection&#x27;s mw instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#b57f158f-d75a-464e-b97a-71ed9f641602 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            name: <span class="hljs-string">"elements"</span>,
                            mw: {
                                methods: sinon.spy()
                            }
                        };
                        Collection.prototype.attachMethods.call(instance);
                        <span class="hljs-keyword">var</span> methods = instance.mw.methods.firstCall.args[<span class="hljs-number">0</span>];
                        R.keys(methods).should.eql([
                            <span class="hljs-string">"/elements/insert"</span>,
                            <span class="hljs-string">"/elements/update"</span>,
                            <span class="hljs-string">"/elements/remove"</span>
                        ]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="29fac72a-93e3-45cc-a894-ca7a08dff136" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The Collection constructor</h3>
                <h5 class="suite-filename">/test/unit/collection/constructor.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="29fac72a-93e3-45cc-a894-ca7a08dff136" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#29fac72a-93e3-45cc-a894-ca7a08dff136-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="29fac72a-93e3-45cc-a894-ca7a08dff136-test-list" class="list-group test-list collapse in">
                        <div id="ff4d56a3-67eb-41c2-bea9-3d3638cf9a31" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should save the mw instance, the name, and init the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#ff4d56a3-67eb-41c2-bea9-3d3638cf9a31 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> mw = {};
                        <span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.mw.should.equal(mw);
                        Elements.name.should.equal(<span class="hljs-string">"elements"</span>);
                        Collection.prototype.createDbProxy.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.createDbProxy.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.attachMethods.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.attachMethods.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.initValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.initValidationRules.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="70dd187b-d447-4581-9e32-23f793e5cae6" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The createDbProxy method</h3>
                <h5 class="suite-filename">/test/unit/collection/createDbProxy.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="70dd187b-d447-4581-9e32-23f793e5cae6" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#70dd187b-d447-4581-9e32-23f793e5cae6-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="70dd187b-d447-4581-9e32-23f793e5cae6-test-list" class="list-group test-list collapse in">
                        <div id="fcf5c9aa-dc25-4c97-bfd1-8497f2a67f5c" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should create the dbCollection proxy as a property of to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#fcf5c9aa-dc25-4c97-bfd1-8497f2a67f5c > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            name: <span class="hljs-string">"elements"</span>,
                            mw: {
                                db: {
                                    collection: R.always({
                                        findOne: R.always(),
                                        insert: R.always(),
                                        update: R.always(),
                                        remove: R.always()
                                    })
                                }
                            }
                        };
                        Collection.prototype.createDbProxy.call(instance);
                        instance.dbCollection.should.be.a.Object;
                        instance.dbCollection.findOne.should.be.a.Function;
                        instance.dbCollection.insert.should.be.a.Function;
                        instance.dbCollection.update.should.be.a.Function;
                        instance.dbCollection.remove.should.be.a.Function;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="b70f41a2-3cc0-4097-b9a1-e37711b72fbf" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The initValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/initValidationRules.js.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="b70f41a2-3cc0-4097-b9a1-e37711b72fbf" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#b70f41a2-3cc0-4097-b9a1-e37711b72fbf-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="b70f41a2-3cc0-4097-b9a1-e37711b72fbf-test-list" class="list-group test-list collapse in">
                        <div id="0f012d21-6c46-4fc3-a5a2-d293a6c72326" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should create the validationRules store as a property of to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#0f012d21-6c46-4fc3-a5a2-d293a6c72326 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {};
                        Collection.prototype.initValidationRules.call(instance);
                        instance.validationRules.should.eql({
                            insert: [],
                            update: [],
                            remove: []
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="f99eb51d-c0b4-444c-ad7c-6465abbef3fd" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The runValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/runValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="f99eb51d-c0b4-444c-ad7c-6465abbef3fd" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">7 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#f99eb51d-c0b4-444c-ad7c-6465abbef3fd-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="f99eb51d-c0b4-444c-ad7c-6465abbef3fd-test-list" class="list-group test-list collapse in">
                        <div id="53aa4eac-99f7-41a3-95fd-15e90878f811" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#53aa4eac-99f7-41a3-95fd-15e90878f811 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: []
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, {}, {})
                            .should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="784ab0c8-ee4e-4160-a069-845b267f4985" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run all validation rules for the specified method
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#784ab0c8-ee4e-4160-a069-845b267f4985 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> rule_0 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> rule_1 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> rule_2 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [rule_0, rule_1, rule_2]
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, {}, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                rule_0.called.should.equal(<span class="hljs-literal">true</span>);
                                rule_1.called.should.equal(<span class="hljs-literal">true</span>);
                                rule_2.called.should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="2bc28b54-5c1b-457a-8466-a84c5341dc01" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call rules with the correct context and arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#2bc28b54-5c1b-457a-8466-a84c5341dc01 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> insertRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> updateRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> removeRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [insertRule],
                                update: [updateRule],
                                remove: [removeRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> context = {context: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> oldDocument = {oldDocument: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> newDocument = {newDocument: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> insertResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, newDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                insertRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                insertRule.firstCall.args.length.should.equal(<span class="hljs-number">1</span>);
                                insertRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(newDocument);
                            });
                        <span class="hljs-keyword">var</span> updateResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"update"</span>, oldDocument, newDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                updateRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                updateRule.firstCall.args.length.should.equal(<span class="hljs-number">2</span>);
                                updateRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(oldDocument);
                                updateRule.firstCall.args[<span class="hljs-number">1</span>].should.eql(newDocument);
                            });
                        <span class="hljs-keyword">var</span> removeResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"remove"</span>, oldDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                removeRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                removeRule.firstCall.args.length.should.equal(<span class="hljs-number">1</span>);
                                removeRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(oldDocument);
                            });
                        <span class="hljs-keyword">return</span> BPromise.all([
                            insertResult,
                            updateResult,
                            removeResult
                        ]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="bbb49f09-8c75-459c-9f5c-2ba446959f77" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the runValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/runValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="bbb49f09-8c75-459c-9f5c-2ba446959f77" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">4 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#bbb49f09-8c75-459c-9f5c-2ba446959f77-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="bbb49f09-8c75-459c-9f5c-2ba446959f77-test-list" class="list-group test-list collapse in">
                        <div id="d1cd7c0d-ed4e-41d4-8f23-c396ed172a54" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be fulfilled if all validation rules return either a value or an eventually fulfilled promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d1cd7c0d-ed4e-41d4-8f23-c396ed172a54 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> rule_0 = sinon.stub().returns(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">var</span> rule_1 = sinon.stub().returns(<span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">var</span> rule_2 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [rule_0, rule_1, rule_2]
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.fulfilled;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="203486cf-9f6e-4be6-9eec-717f342b08e8" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if any of the validation rules either throws or returns an eventually rejected promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#203486cf-9f6e-4be6-9eec-717f342b08e8 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> goodRule = sinon.stub().returns(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">var</span> badRule = sinon.stub().throws(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>());
                        <span class="hljs-keyword">var</span> eventuallyBadRule = sinon.stub().returns(BPromise.reject());
                        <span class="hljs-keyword">var</span> instance_0 = {
                            validationRules: {
                                insert: [goodRule, badRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> rejection_0 = Collection.prototype.runValidationRules
                            .call(instance_0, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.rejected;
                        <span class="hljs-keyword">var</span> instance_1 = {
                            validationRules: {
                                insert: [goodRule, eventuallyBadRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> rejection_1 = Collection.prototype.runValidationRules
                            .call(instance_1, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.rejected;
                        <span class="hljs-keyword">return</span> BPromise.all([rejection_0, rejection_1]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="ce7d7f06-dd91-48c4-9c6a-79d644cc0674" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The applyPatches function</h3>
                <h5 class="suite-filename">/test/unit/lib/apply-patches.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="ce7d7f06-dd91-48c4-9c6a-79d644cc0674" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#ce7d7f06-dd91-48c4-9c6a-79d644cc0674-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="ce7d7f06-dd91-48c4-9c6a-79d644cc0674-test-list" class="list-group test-list collapse in">
                        <div id="074495b9-194a-419b-a19a-9c1ad525ef41" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should apply the supplied set of patches to the supplied object
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#074495b9-194a-419b-a19a-9c1ad525ef41 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> oldObj = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> newObj = {
                            a: <span class="hljs-number">2</span>
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare(oldObj, newObj);
                        <span class="hljs-keyword">var</span> patchedObj = applyPatches(oldObj, patches);
                        patchedObj.should.eql(newObj);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="97ab04b6-4666-4b5f-81b3-2d449a69b5b3" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not mutate the object to which it applies patches
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#97ab04b6-4666-4b5f-81b3-2d449a69b5b3 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> oldObj = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> oldObjClone = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> newObj = {
                            a: <span class="hljs-number">2</span>
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare(oldObj, newObj);
                        applyPatches(oldObj, patches);
                        oldObj.should.eql(oldObjClone);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="6c5587c8-de04-4245-be0f-273a2d23ddb9" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The argMatches function</h3>
                <h5 class="suite-filename">/test/unit/lib/arg-matches.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="6c5587c8-de04-4245-be0f-273a2d23ddb9" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#6c5587c8-de04-4245-be0f-273a2d23ddb9-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="6c5587c8-de04-4245-be0f-273a2d23ddb9-test-list" class="list-group test-list collapse in">
                        <div id="0ec6f55a-952f-4846-96c3-b6c99dcd9283" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return true the argument is of the correct type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#0ec6f55a-952f-4846-96c3-b6c99dcd9283 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">argMatches(t.Str, <span class="hljs-string">"I'm a string"</span>).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="dd133aac-a2e9-4e01-a6fe-46dee05562a6" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should throw an MW.Error if the argument is of the incorrect type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#dd133aac-a2e9-4e01-a6fe-46dee05562a6 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">argMatches(t.Num, <span class="hljs-string">"I'm a string, not a number"</span>).should.equal(<span class="hljs-literal">false</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="86c84287-67cf-4258-9c72-d24fbb1c7bd0" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The ensure function</h3>
                <h5 class="suite-filename">/test/unit/lib/ensure.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="86c84287-67cf-4258-9c72-d24fbb1c7bd0" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#86c84287-67cf-4258-9c72-d24fbb1c7bd0-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="86c84287-67cf-4258-9c72-d24fbb1c7bd0-test-list" class="list-group test-list collapse in">
                        <div id="3639cf4c-5be7-4dd4-9834-375cda940ae4" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not throw if the condition is truthy
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3639cf4c-5be7-4dd4-9834-375cda940ae4 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> peacefulFella = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            ensure(error, <span class="hljs-literal">true</span>);
                        };
                        peacefulFella.should.not.throw();</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="15cbaad1-946f-48d1-8376-9e0d6c709b47" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should throw if the condition is falsy
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#15cbaad1-946f-48d1-8376-9e0d6c709b47 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> troublemaker = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            ensure(error, <span class="hljs-literal">false</span>);
                        };
                        troublemaker.should.throw(<span class="hljs-built_in">Error</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="021f592a-3d17-419b-83e9-34f3d6833ee3" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The getOldDocument function</h3>
                <h5 class="suite-filename">/test/unit/lib/get-old-document.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="021f592a-3d17-419b-83e9-34f3d6833ee3" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#021f592a-3d17-419b-83e9-34f3d6833ee3-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="021f592a-3d17-419b-83e9-34f3d6833ee3-test-list" class="list-group test-list collapse in">
                        <div id="7ff68cdb-75d4-4cdc-897f-4e168aa23a26" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#7ff68cdb-75d4-4cdc-897f-4e168aa23a26 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="43920f4f-2b09-461c-a545-74cb5931cf2b" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the getOldDocument function</h3>
                <h5 class="suite-filename">/test/unit/lib/get-old-document.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="43920f4f-2b09-461c-a545-74cb5931cf2b" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#43920f4f-2b09-461c-a545-74cb5931cf2b-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="43920f4f-2b09-461c-a545-74cb5931cf2b-test-list" class="list-group test-list collapse in">
                        <div id="8274eba4-2805-472b-a1df-619471178453" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be fulfilled if a document is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#8274eba4-2805-472b-a1df-619471178453 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.fulfilledWith({});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="37ab8a23-c836-4618-9d58-db9b4cc7c7e0" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected with a MW.Error if no document is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#37ab8a23-c836-4618-9d58-db9b4cc7c7e0 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.rejectedWith(MW.Error);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="28b0622a-d430-433f-93aa-13f896a7c1db" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The PatchesType object</h3>
                <h5 class="suite-filename">/test/unit/lib/patches-type.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="28b0622a-d430-433f-93aa-13f896a7c1db" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#28b0622a-d430-433f-93aa-13f896a7c1db-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="28b0622a-d430-433f-93aa-13f896a7c1db-test-list" class="list-group test-list collapse in">
                        <div id="9a7c2d77-b319-4bbf-b580-030cbca80e30" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be a tcomb type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#9a7c2d77-b319-4bbf-b580-030cbca80e30 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">t.Type.is(PatchesType).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="b63d527d-d50e-4452-ad08-5248d3b2eb95" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should match valid JSON patches, unless they&#x27;re an empty array
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#b63d527d-d50e-4452-ad08-5248d3b2eb95 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> validPatches_0 = [{
                            op: <span class="hljs-string">"add"</span>,
                            path: <span class="hljs-string">"/prop"</span>,
                            value: <span class="hljs-string">"value"</span>
                        }];
                        <span class="hljs-keyword">var</span> validPatches_1 = jp.compare({a: <span class="hljs-number">1</span>}, {b: <span class="hljs-number">1</span>});
                        t.validate(validPatches_0, PatchesType).isValid().should.equal(<span class="hljs-literal">true</span>);
                        t.validate(validPatches_1, PatchesType).isValid().should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="270ddfc0-dfb9-4003-a2b3-f0e58b50f76d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not match invalid JSON patches and empty arrays
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#270ddfc0-dfb9-4003-a2b3-f0e58b50f76d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> invalidPatches_0 = [{a: <span class="hljs-number">2</span>}];
                        t.validate(invalidPatches_0, PatchesType).isValid().should.equal(<span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">var</span> invalidPatches_1 = [];
                        t.validate(invalidPatches_1, PatchesType).isValid().should.equal(<span class="hljs-literal">false</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="7c9e6409-4bee-497f-a946-13433d5d2a27" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The randomId function</h3>
                <h5 class="suite-filename">/test/unit/lib/random-id.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="7c9e6409-4bee-497f-a946-13433d5d2a27" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#7c9e6409-4bee-497f-a946-13433d5d2a27-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="7c9e6409-4bee-497f-a946-13433d5d2a27-test-list" class="list-group test-list collapse in">
                        <div id="99b58062-59c0-465d-b15a-2d8a5a4922c7" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should generate a random 16-bytes string (32 characters long)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#99b58062-59c0-465d-b15a-2d8a5a4922c7 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> string = randomId();
                        string.should.be.a.String;
                        string.length.should.equal(<span class="hljs-number">32</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="37e99f02-efc0-4bd1-9515-523cf316c390" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The insert method</h3>
                <h5 class="suite-filename">/test/unit/methods/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="37e99f02-efc0-4bd1-9515-523cf316c390" class="suite-chart" width="50" height="50" data-total-passes="4" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">4 ms</li>
                    <li class="suite-summary-item tests">4</li>
                    <li class="suite-summary-item passed">4</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#37e99f02-efc0-4bd1-9515-523cf316c390-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="37e99f02-efc0-4bd1-9515-523cf316c390-test-list" class="list-group test-list collapse in">
                        <div id="d8256296-8a12-4f91-b34f-1138208574e5" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d8256296-8a12-4f91-b34f-1138208574e5 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.insert();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="39c7445f-7911-48c6-83ab-056416deb78e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation insert rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#39c7445f-7911-48c6-83ab-056416deb78e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy()
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"insert"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="7dd72678-8c2f-472b-bbb9-f025c5921ef9" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should give the document a random _id if it doesn&#x27;t have one
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#7dd72678-8c2f-472b-bbb9-f025c5921ef9 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> insertedDocument = collection.dbCollection.insert.firstCall.args[<span class="hljs-number">0</span>];
                                insertedDocument._id.should.be.a.String;
                                insertedDocument._id.length.should.equal(<span class="hljs-number">32</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="b66b5349-71e0-4378-9bdb-16acae8c8516" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.insert with the new document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#b66b5349-71e0-4378-9bdb-16acae8c8516 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {_id: <span class="hljs-string">"_id"</span>, a: <span class="hljs-number">1</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.insert.calledWith({
                                    _id: <span class="hljs-string">"_id"</span>,
                                    a: <span class="hljs-number">1</span>
                                }).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="f70e7e3a-ab62-469c-94b0-0bc15ce4bc1f" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the insert method</h3>
                <h5 class="suite-filename">/test/unit/methods/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="f70e7e3a-ab62-469c-94b0-0bc15ce4bc1f" class="suite-chart" width="50" height="50" data-total-passes="4" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">3 ms</li>
                    <li class="suite-summary-item tests">4</li>
                    <li class="suite-summary-item passed">4</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#f70e7e3a-ab62-469c-94b0-0bc15ce4bc1f-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="f70e7e3a-ab62-469c-94b0-0bc15ce4bc1f-test-list" class="list-group test-list collapse in">
                        <div id="57cde43f-80a9-43d4-95f9-7d687a733a4e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;newDocument&#x60; is not an object
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#57cde43f-80a9-43d4-95f9-7d687a733a4e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.insert().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `newDocument` must be an object"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="b089ab95-54ba-4f26-9ffa-bfa4d26fcc0e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#b089ab95-54ba-4f26-9ffa-bfa4d26fcc0e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            ))
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {}).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="3a8afb50-de90-4c71-8799-af9197058992" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if inserting fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3a8afb50-de90-4c71-8799-af9197058992 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Insert error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {}).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Insert error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="4291f294-39b7-4c54-9188-a22994e0cd46" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4291f294-39b7-4c54-9188-a22994e0cd46 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="99a98a85-701e-4630-9cdb-d13d27e439c3" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The remove method</h3>
                <h5 class="suite-filename">/test/unit/methods/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="99a98a85-701e-4630-9cdb-d13d27e439c3" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">3 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#99a98a85-701e-4630-9cdb-d13d27e439c3-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="99a98a85-701e-4630-9cdb-d13d27e439c3-test-list" class="list-group test-list collapse in">
                        <div id="e0ff7f89-9373-4704-a2a7-5666a422217e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#e0ff7f89-9373-4704-a2a7-5666a422217e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.remove();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d4d35554-7e35-499d-ac48-b13b39784f37" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation remove rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d4d35554-7e35-499d-ac48-b13b39784f37 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy(),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({}))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>)
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"remove"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="17885e6e-4005-4b2f-8574-f7f403693ad9" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.remove to remove the old document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#17885e6e-4005-4b2f-8574-f7f403693ad9 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({_id: <span class="hljs-string">"_id"</span>})),
                                remove: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">"_id"</span>)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.remove.calledWith({
                                    _id: <span class="hljs-string">"_id"</span>
                                }).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="ad035076-320d-43f2-958b-96bd8e1711bd" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the remove method</h3>
                <h5 class="suite-filename">/test/unit/methods/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="ad035076-320d-43f2-958b-96bd8e1711bd" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#ad035076-320d-43f2-958b-96bd8e1711bd-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="ad035076-320d-43f2-958b-96bd8e1711bd-test-list" class="list-group test-list collapse in">
                        <div id="fbd77617-3cd3-488c-b1dd-84cd81da6e8d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;documentId&#x60; is not a string
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#fbd77617-3cd3-488c-b1dd-84cd81da6e8d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.remove().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `documentId` must be a string"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d3abce11-cda4-4d21-8249-bc2fc96efaf3" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if no document with the given id is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d3abce11-cda4-4d21-8249-bc2fc96efaf3 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">404</span>,
                            message: <span class="hljs-string">"Document not found"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a0a98d3e-1ed1-45b1-bd04-fbeabcd1bdca" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a0a98d3e-1ed1-45b1-bd04-fbeabcd1bdca > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            )),
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="ecc8db0b-1b9f-4131-aae3-f1f73a40467d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if removing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#ecc8db0b-1b9f-4131-aae3-f1f73a40467d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                remove: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Remove error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Remove error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="13784a3c-0614-4346-b2da-6093cda994a6" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#13784a3c-0614-4346-b2da-6093cda994a6 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                remove: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="2a702334-0301-4e26-8159-bc757b467909" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The update method</h3>
                <h5 class="suite-filename">/test/unit/methods/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="2a702334-0301-4e26-8159-bc757b467909" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#2a702334-0301-4e26-8159-bc757b467909-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="2a702334-0301-4e26-8159-bc757b467909-test-list" class="list-group test-list collapse in">
                        <div id="f04a6248-32e4-47e8-87e2-8b1c5874c085" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#f04a6248-32e4-47e8-87e2-8b1c5874c085 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.update();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="05b85a00-ae8b-48e7-ac92-a845d702de1d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation update rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#05b85a00-ae8b-48e7-ac92-a845d702de1d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy(),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({}))
                            }
                        };
                        <span class="hljs-keyword">var</span> patches = [{
                            op: <span class="hljs-string">"add"</span>,
                            path: <span class="hljs-string">"/prop"</span>,
                            value: <span class="hljs-string">"value"</span>
                        }];
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches)
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"update"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a46c8e9c-ded0-4b21-96c8-6c9418018c57" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.update with the updated document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a46c8e9c-ded0-4b21-96c8-6c9418018c57 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({_id: <span class="hljs-string">"_id"</span>})),
                                update: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare({}, {a: <span class="hljs-number">1</span>});
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">"_id"</span>, patches)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.update.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.dbCollection.update.firstCall.args[<span class="hljs-number">0</span>].should.eql({
                                    _id: <span class="hljs-string">"_id"</span>
                                });
                                collection.dbCollection.update.firstCall.args[<span class="hljs-number">1</span>].should.eql({
                                    $set: {
                                        a: <span class="hljs-number">1</span>
                                    }
                                });
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="db63fd0e-7125-4cb6-ad23-c7571407cc53" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the update method</h3>
                <h5 class="suite-filename">/test/unit/methods/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="db63fd0e-7125-4cb6-ad23-c7571407cc53" class="suite-chart" width="50" height="50" data-total-passes="6" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">5 ms</li>
                    <li class="suite-summary-item tests">6</li>
                    <li class="suite-summary-item passed">6</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#db63fd0e-7125-4cb6-ad23-c7571407cc53-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="db63fd0e-7125-4cb6-ad23-c7571407cc53-test-list" class="list-group test-list collapse in">
                        <div id="543bcee1-7299-4171-b931-6db0f09614bc" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;documentId&#x60; is not a string
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#543bcee1-7299-4171-b931-6db0f09614bc > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.update().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `documentId` must be a string"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="34042179-794e-4c45-8042-bbb4443e96dd" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;patches&#x60; is not an array of patches
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#34042179-794e-4c45-8042-bbb4443e96dd > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.update(<span class="hljs-literal">null</span>, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"Second argument `patches` must be an array of JSON patches"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="1fef2c6c-d6a6-4ebf-a954-26436e271d73" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if no document with the given id is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#1fef2c6c-d6a6-4ebf-a954-26436e271d73 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">404</span>,
                            message: <span class="hljs-string">"Document not found"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="e03bef76-1ea5-4d94-94bb-ae4e5858958b" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#e03bef76-1ea5-4d94-94bb-ae4e5858958b > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            )),
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a025abcd-76a0-4047-9f45-d55abb584c59" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if updating fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a025abcd-76a0-4047-9f45-d55abb584c59 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                update: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Update error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Update error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="f9bba53f-2e5b-478f-a7af-a4402e49f0c5" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#f9bba53f-2e5b-478f-a7af-a4402e49f0c5 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                update: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="1847e8be-20d2-44ae-ba57-fddf52dd9e9c" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Inserting a document</h3>
                <h5 class="suite-filename">/test/integration/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="1847e8be-20d2-44ae-ba57-fddf52dd9e9c" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">99 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#1847e8be-20d2-44ae-ba57-fddf52dd9e9c-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="1847e8be-20d2-44ae-ba57-fddf52dd9e9c-test-list" class="list-group test-list collapse in">
                        <div id="d61783bd-9fa3-406b-a999-63979d72143c" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d61783bd-9fa3-406b-a999-63979d72143c > .test-code.collapse">Code</button>
                              <span class="test-duration medium">73 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [<span class="hljs-string">"myDocument"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `newDocument` must be an object"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="13a93e72-7249-4b1b-a29f-e88d608e2971" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#13a93e72-7249-4b1b-a29f-e88d608e2971 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">9 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="24bfa8fc-14f6-419f-869a-50e04617346e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#24bfa8fc-14f6-419f-869a-50e04617346e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="99420ed0-e26d-4558-8357-c36b77b817b8" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              inserting the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#99420ed0-e26d-4558-8357-c36b77b817b8 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">6 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> cursor = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>).find({});
                                <span class="hljs-keyword">return</span> BPromise.promisify(cursor.count, cursor)();
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(count)</span> </span>{
                                count.should.equal(<span class="hljs-number">1</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="08ca8781-56c5-47c4-bdc2-644d566a12cf" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              automatic assignment of a string _id
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#08ca8781-56c5-47c4-bdc2-644d566a12cf > .test-code.collapse">Code</button>
                              <span class="test-duration fast">7 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({});
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                element._id.should.be.a.String;
                                element._id.length.should.equal(<span class="hljs-number">32</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="d86a06fb-948e-4bb9-b9f6-c9008eac6a7f" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Removing a document</h3>
                <h5 class="suite-filename">/test/integration/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="d86a06fb-948e-4bb9-b9f6-c9008eac6a7f" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">19 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#d86a06fb-948e-4bb9-b9f6-c9008eac6a7f-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="d86a06fb-948e-4bb9-b9f6-c9008eac6a7f-test-list" class="list-group test-list collapse in">
                        <div id="8f31c3bb-fe24-4722-a328-0af6393be17d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#8f31c3bb-fe24-4722-a328-0af6393be17d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `documentId` must be a string"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="05715ee0-754c-453f-be6b-e0af0f3c96e3" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              404 on document not found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#05715ee0-754c-453f-be6b-e0af0f3c96e3 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"idNotInDatabase"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">404</span>)
                            .expect({error: <span class="hljs-string">"Document not found"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="ee4ed6fe-7f61-4042-9d99-fc3f64889878" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#ee4ed6fe-7f61-4042-9d99-fc3f64889878 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="ab87ea72-1322-497d-93f6-1bbb43cb30ea" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#ab87ea72-1322-497d-93f6-1bbb43cb30ea > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="6e9919f4-c740-4bf9-acd8-a115968ebb95" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              removing the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#6e9919f4-c740-4bf9-acd8-a115968ebb95 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({
                                    _id: <span class="hljs-string">"elementId"</span>
                                });
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                (element === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="77554d7e-3e4e-477c-a427-41f367ae1e6e" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Updating a document</h3>
                <h5 class="suite-filename">/test/integration/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="77554d7e-3e4e-477c-a427-41f367ae1e6e" class="suite-chart" width="50" height="50" data-total-passes="6" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">23 ms</li>
                    <li class="suite-summary-item tests">6</li>
                    <li class="suite-summary-item passed">6</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#77554d7e-3e4e-477c-a427-41f367ae1e6e-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="77554d7e-3e4e-477c-a427-41f367ae1e6e-test-list" class="list-group test-list collapse in">
                        <div id="9b8ed0c7-f40f-4bd9-861b-7280f6b2de98" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments [first argument]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#9b8ed0c7-f40f-4bd9-861b-7280f6b2de98 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [{}, <span class="hljs-string">"previous-arg-not-a-string"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `documentId` must be a string"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="6cd6ba86-3f17-4ae9-8c71-7c0ac979a7a9" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments [second argument]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#6cd6ba86-3f17-4ae9-8c71-7c0ac979a7a9 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"second-arg-not-array-of-patches"</span>, {}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"Second argument `patches` must be an array of JSON patches"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a243a492-2522-4409-94f7-d0edb6c4e311" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              404 on document not found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a243a492-2522-4409-94f7-d0edb6c4e311 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"idNotInDatabase"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">404</span>)
                            .expect({error: <span class="hljs-string">"Document not found"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="2a9af702-314a-4ed5-9055-d4606a0db5cd" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#2a9af702-314a-4ed5-9055-d4606a0db5cd > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="765069fc-f767-4563-b2c1-379ba7cc10d7" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#765069fc-f767-4563-b2c1-379ba7cc10d7 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">5 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="c24d93f3-0478-4416-81a5-1bd39cb5be1d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              updating the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#c24d93f3-0478-4416-81a5-1bd39cb5be1d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">5 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({
                                    _id: <span class="hljs-string">"elementId"</span>
                                });
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                element.should.eql({
                                    _id: <span class="hljs-string">"elementId"</span>,
                                    prop: <span class="hljs-string">"value"</span>
                                });
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
    </div>

    <footer>
      <div class="container">
        <p>Report generated by <a href="https://github.dowjones.net/grubera/mochawesome" target="_blank">mochawesome</a>.<br>Designed and built by <a href="https://github.com/adamgruber" target="_blank">adamgruber</a>. &copy;2015.</p>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="js/vendor.js"></script>
    <script src="js/mochawesome.js"></script>
  </body>
</html>
