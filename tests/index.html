<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mochawesome Report Card</title>
    <link rel="stylesheet" href="css/mochawesome.css">
  </head>
  <body>
    <!-- NAVBAR -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="report-info-cnt">
          <h1 class="report-title">meteor-wapi-collection</h1>
          <h3 class="report-date">Friday, May 1 2015, 10:30pm</h3>
        </div>
        <div class="quick-summary-cnt">
            <ul class="list-unstyled quick-summary">
              <li class="qs-item summary-duration" title="Duration">251<span>MS</span></li>
              <li class="qs-item summary-suites" title="Suites">23</li>
              <li class="qs-item summary-tests" title="Tests">65</li>
              <li class="qs-item summary-passes" title="Passed" data-filter="passed">65</li>
              <li class="qs-item summary-failures" title="Failed" data-filter="failed">0</li>
              <li class="qs-item summary-pending" title="Pending" data-filter="pending">0</li>
            </ul>        </div>
      </div>
    </div>

    <!-- Report Summary -->
    <div class="summary">
      <div class="container">
          <div class="row">
            <div class="summary-col summary-duration">
              <h1 class="summary-count">251<span>MS</span></h1>
              <h4 class="summary-label">MS</h4>
            </div>
            <div class="summary-col summary-suites" title="Suites">
              <h1 class="summary-count">23</h1>
              <h4 class="summary-label">Suites</h4>
            </div>
            <div class="summary-col summary-tests" title="Tests">
              <h1 class="summary-count">65</h1>
              <h4 class="summary-label">Tests</h4>
            </div>
            <div class="summary-col summary-passes" data-filter="passed" title="Passed">
              <h1 class="summary-count">65</h1>
              <h4 class="summary-label">Passed</h4>
            </div>
            <div class="summary-col summary-failures" data-filter="failed" title="Failed">
              <h1 class="summary-count">0</h1>
              <h4 class="summary-label">Failed</h4>
            </div>
            <div class="summary-col summary-pending" data-filter="pending" title="Pending">
              <h1 class="summary-count">0</h1>
              <h4 class="summary-label">Pending</h4>
            </div>
          </div>      </div>
    </div>
    <div class="statusbar">
      <div class="container">
          <div class="row">
            <div class="status-item status-item-pending-pct">0% Pending</div>
            <div class="status-item status-item-passing-pct success">100% Passing</div>
          </div>      </div>
    </div>

    <!-- Suites -->
    <div class="details container">
            <section class="suite-wrap">
              <div id="4dabfc63-60f1-440d-8161-ba9d92e1b5a5" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The addValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/addValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="4dabfc63-60f1-440d-8161-ba9d92e1b5a5" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#4dabfc63-60f1-440d-8161-ba9d92e1b5a5-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="4dabfc63-60f1-440d-8161-ba9d92e1b5a5-test-list" class="list-group test-list collapse in">
                        <div id="9adb2add-6831-42b1-893f-74dc103bb6a2" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should add validation rules to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#9adb2add-6831-42b1-893f-74dc103bb6a2 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [],
                                update: [],
                                remove: []
                            }
                        };
                        <span class="hljs-keyword">var</span> insert = sinon.spy();
                        <span class="hljs-keyword">var</span> update = sinon.spy();
                        <span class="hljs-keyword">var</span> remove = sinon.spy();
                        Collection.prototype.addValidationRules.call(instance, {
                            insert: insert,
                            update: update,
                            remove: remove
                        });
                        instance.validationRules.insert[<span class="hljs-number">0</span>].should.equal(insert);
                        instance.validationRules.update[<span class="hljs-number">0</span>].should.equal(update);
                        instance.validationRules.remove[<span class="hljs-number">0</span>].should.equal(remove);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="675ddaea-9060-4fb2-80cf-4e46386c9bba" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return the collection instance to allow method chaining
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#675ddaea-9060-4fb2-80cf-4e46386c9bba > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [],
                                update: [],
                                remove: []
                            }
                        };
                        <span class="hljs-keyword">var</span> insert = sinon.spy();
                        <span class="hljs-keyword">var</span> update = sinon.spy();
                        <span class="hljs-keyword">var</span> remove = sinon.spy();
                        <span class="hljs-keyword">var</span> ret = Collection.prototype.addValidationRules.call(instance, {});
                        ret.should.equal(instance);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="2958f1a3-dd75-448a-a0d9-1233dc6af203" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The attachMethods method</h3>
                <h5 class="suite-filename">/test/unit/collection/attachMethods.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="2958f1a3-dd75-448a-a0d9-1233dc6af203" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#2958f1a3-dd75-448a-a0d9-1233dc6af203-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="2958f1a3-dd75-448a-a0d9-1233dc6af203-test-list" class="list-group test-list collapse in">
                        <div id="db0e09ec-1b84-43e2-b467-593719f9ae5c" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should attach methods to the collection&#x27;s mw instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#db0e09ec-1b84-43e2-b467-593719f9ae5c > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            name: <span class="hljs-string">"elements"</span>,
                            mw: {
                                methods: sinon.spy()
                            }
                        };
                        Collection.prototype.attachMethods.call(instance);
                        <span class="hljs-keyword">var</span> methods = instance.mw.methods.firstCall.args[<span class="hljs-number">0</span>];
                        R.keys(methods).should.eql([
                            <span class="hljs-string">"/elements/insert"</span>,
                            <span class="hljs-string">"/elements/update"</span>,
                            <span class="hljs-string">"/elements/remove"</span>
                        ]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="9c75fe75-8089-4340-98a7-807828a5c8d8" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The Collection constructor</h3>
                <h5 class="suite-filename">/test/unit/collection/constructor.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="9c75fe75-8089-4340-98a7-807828a5c8d8" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#9c75fe75-8089-4340-98a7-807828a5c8d8-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="9c75fe75-8089-4340-98a7-807828a5c8d8-test-list" class="list-group test-list collapse in">
                        <div id="169c16f7-30c2-476b-bcfd-dc91a63ffef1" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should save the mw instance, the name, and init the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#169c16f7-30c2-476b-bcfd-dc91a63ffef1 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> mw = {};
                        <span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.mw.should.equal(mw);
                        Elements.name.should.equal(<span class="hljs-string">"elements"</span>);
                        Collection.prototype.createDbProxy.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.createDbProxy.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.attachMethods.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.attachMethods.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.initValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                        Collection.prototype.initValidationRules.calledOn(Elements).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="380a4497-e0d4-4bd9-a355-d740f0474de2" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The createDbProxy method</h3>
                <h5 class="suite-filename">/test/unit/collection/createDbProxy.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="380a4497-e0d4-4bd9-a355-d740f0474de2" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#380a4497-e0d4-4bd9-a355-d740f0474de2-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="380a4497-e0d4-4bd9-a355-d740f0474de2-test-list" class="list-group test-list collapse in">
                        <div id="bfb1ec5c-eb7f-4ab3-a70b-9cc8a8ff750c" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should create the dbCollection proxy as a property of to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#bfb1ec5c-eb7f-4ab3-a70b-9cc8a8ff750c > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            name: <span class="hljs-string">"elements"</span>,
                            mw: {
                                db: {
                                    collection: R.always({
                                        findOne: R.always(),
                                        insert: R.always(),
                                        update: R.always(),
                                        remove: R.always()
                                    })
                                }
                            }
                        };
                        Collection.prototype.createDbProxy.call(instance);
                        instance.dbCollection.should.be.a.Object;
                        instance.dbCollection.findOne.should.be.a.Function;
                        instance.dbCollection.insert.should.be.a.Function;
                        instance.dbCollection.update.should.be.a.Function;
                        instance.dbCollection.remove.should.be.a.Function;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="7a62778f-4194-4f32-b696-eafac74f74da" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The initValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/initValidationRules.js.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="7a62778f-4194-4f32-b696-eafac74f74da" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#7a62778f-4194-4f32-b696-eafac74f74da-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="7a62778f-4194-4f32-b696-eafac74f74da-test-list" class="list-group test-list collapse in">
                        <div id="5bfddfda-5347-4b41-b67f-31d12204305b" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should create the validationRules store as a property of to the collection instance
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#5bfddfda-5347-4b41-b67f-31d12204305b > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {};
                        Collection.prototype.initValidationRules.call(instance);
                        instance.validationRules.should.eql({
                            insert: [],
                            update: [],
                            remove: []
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="211a2d88-de49-4cea-8b3a-de67ee76e295" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The runValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/runValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="211a2d88-de49-4cea-8b3a-de67ee76e295" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">6 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#211a2d88-de49-4cea-8b3a-de67ee76e295-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="211a2d88-de49-4cea-8b3a-de67ee76e295-test-list" class="list-group test-list collapse in">
                        <div id="c8c8af4f-1e1d-4e40-9142-30d9e6ed5984" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#c8c8af4f-1e1d-4e40-9142-30d9e6ed5984 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: []
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, {}, {})
                            .should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="e218fe6f-e5da-4db7-b6a5-658b60ede5b5" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run all validation rules for the specified method
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#e218fe6f-e5da-4db7-b6a5-658b60ede5b5 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> rule_0 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> rule_1 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> rule_2 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [rule_0, rule_1, rule_2]
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, {}, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                rule_0.called.should.equal(<span class="hljs-literal">true</span>);
                                rule_1.called.should.equal(<span class="hljs-literal">true</span>);
                                rule_2.called.should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="feb9bfec-15af-4c26-8808-2a498c6288f6" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call rules with the correct context and arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#feb9bfec-15af-4c26-8808-2a498c6288f6 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> insertRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> updateRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> removeRule = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [insertRule],
                                update: [updateRule],
                                remove: [removeRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> context = {context: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> oldDocument = {oldDocument: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> newDocument = {newDocument: <span class="hljs-literal">true</span>};
                        <span class="hljs-keyword">var</span> insertResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, newDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                insertRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                insertRule.firstCall.args.length.should.equal(<span class="hljs-number">1</span>);
                                insertRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(newDocument);
                            });
                        <span class="hljs-keyword">var</span> updateResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"update"</span>, oldDocument, newDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                updateRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                updateRule.firstCall.args.length.should.equal(<span class="hljs-number">2</span>);
                                updateRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(oldDocument);
                                updateRule.firstCall.args[<span class="hljs-number">1</span>].should.eql(newDocument);
                            });
                        <span class="hljs-keyword">var</span> removeResult = Collection.prototype.runValidationRules
                            .call(instance, context, <span class="hljs-string">"remove"</span>, oldDocument)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                removeRule.calledOn(context).should.equal(<span class="hljs-literal">true</span>);
                                removeRule.firstCall.args.length.should.equal(<span class="hljs-number">1</span>);
                                removeRule.firstCall.args[<span class="hljs-number">0</span>].should.eql(oldDocument);
                            });
                        <span class="hljs-keyword">return</span> BPromise.all([
                            insertResult,
                            updateResult,
                            removeResult
                        ]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="3c309032-33c0-435d-a0a0-d3428b197182" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the runValidationRules method</h3>
                <h5 class="suite-filename">/test/unit/collection/runValidationRules.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="3c309032-33c0-435d-a0a0-d3428b197182" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">4 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#3c309032-33c0-435d-a0a0-d3428b197182-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="3c309032-33c0-435d-a0a0-d3428b197182-test-list" class="list-group test-list collapse in">
                        <div id="5704f004-18c6-43e3-8ac2-a55e18c05a07" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be fulfilled if all validation rules return either a value or an eventually fulfilled promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#5704f004-18c6-43e3-8ac2-a55e18c05a07 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> rule_0 = sinon.stub().returns(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">var</span> rule_1 = sinon.stub().returns(<span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">var</span> rule_2 = sinon.stub().returns(BPromise.resolve());
                        <span class="hljs-keyword">var</span> instance = {
                            validationRules: {
                                insert: [rule_0, rule_1, rule_2]
                            }
                        };
                        <span class="hljs-keyword">return</span> Collection.prototype.runValidationRules
                            .call(instance, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.fulfilled;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="71b7b6de-b539-4978-b8e2-c37b059edda0" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if any of the validation rules either throws or returns an eventually rejected promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#71b7b6de-b539-4978-b8e2-c37b059edda0 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> goodRule = sinon.stub().returns(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">var</span> badRule = sinon.stub().throws(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>());
                        <span class="hljs-keyword">var</span> eventuallyBadRule = sinon.stub().returns(BPromise.reject());
                        <span class="hljs-keyword">var</span> instance_0 = {
                            validationRules: {
                                insert: [goodRule, badRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> rejection_0 = Collection.prototype.runValidationRules
                            .call(instance_0, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.rejected;
                        <span class="hljs-keyword">var</span> instance_1 = {
                            validationRules: {
                                insert: [goodRule, eventuallyBadRule]
                            }
                        };
                        <span class="hljs-keyword">var</span> rejection_1 = Collection.prototype.runValidationRules
                            .call(instance_1, {}, <span class="hljs-string">"insert"</span>, <span class="hljs-literal">null</span>, {}).should.be.rejected;
                        <span class="hljs-keyword">return</span> BPromise.all([rejection_0, rejection_1]);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="f11f02af-fd02-4deb-8a9b-9b248987495d" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The insert method</h3>
                <h5 class="suite-filename">/test/unit/methods/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="f11f02af-fd02-4deb-8a9b-9b248987495d" class="suite-chart" width="50" height="50" data-total-passes="4" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">3 ms</li>
                    <li class="suite-summary-item tests">4</li>
                    <li class="suite-summary-item passed">4</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#f11f02af-fd02-4deb-8a9b-9b248987495d-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="f11f02af-fd02-4deb-8a9b-9b248987495d-test-list" class="list-group test-list collapse in">
                        <div id="12ff7015-d60a-4aef-a961-b14a6e2406c0" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#12ff7015-d60a-4aef-a961-b14a6e2406c0 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.insert();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="3508203b-4a42-445c-bbd4-dc4f57b00092" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation insert rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3508203b-4a42-445c-bbd4-dc4f57b00092 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy()
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"insert"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d3bbf8d1-041d-4a30-9890-b005b6de089f" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should give the document a random _id if it doesn&#x27;t have one
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d3bbf8d1-041d-4a30-9890-b005b6de089f > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> insertedDocument = collection.dbCollection.insert.firstCall.args[<span class="hljs-number">0</span>];
                                insertedDocument._id.should.be.a.String;
                                insertedDocument._id.length.should.equal(<span class="hljs-number">32</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="360a0087-c80d-402d-8b2c-a44d09970e41" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.insert with the new document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#360a0087-c80d-402d-8b2c-a44d09970e41 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {_id: <span class="hljs-string">"_id"</span>, a: <span class="hljs-number">1</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.insert.calledWith({
                                    _id: <span class="hljs-string">"_id"</span>,
                                    a: <span class="hljs-number">1</span>
                                }).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="f51b60dd-b09c-4571-b553-cdf8e0973615" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the insert method</h3>
                <h5 class="suite-filename">/test/unit/methods/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="f51b60dd-b09c-4571-b553-cdf8e0973615" class="suite-chart" width="50" height="50" data-total-passes="4" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">4</li>
                    <li class="suite-summary-item passed">4</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#f51b60dd-b09c-4571-b553-cdf8e0973615-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="f51b60dd-b09c-4571-b553-cdf8e0973615-test-list" class="list-group test-list collapse in">
                        <div id="3c7aa725-4838-48dd-bcda-abd19b7c7016" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;newDocument&#x60; is not an object
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3c7aa725-4838-48dd-bcda-abd19b7c7016 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.insert().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `newDocument` must be an object"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d2c6cf7d-6cf2-4eaf-b39e-8095eb352d6d" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d2c6cf7d-6cf2-4eaf-b39e-8095eb352d6d > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            ))
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {}).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="c5a67760-3755-4b1b-a241-0489843b31ff" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if inserting fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#c5a67760-3755-4b1b-a241-0489843b31ff > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Insert error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {}).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Insert error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="2acebf32-cc50-474e-b857-781a4cc21945" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#2acebf32-cc50-474e-b857-781a4cc21945 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                insert: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.insert(collection, {})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="cba2068e-dd62-46bd-ba38-86a1cf01bc3f" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The remove method</h3>
                <h5 class="suite-filename">/test/unit/methods/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="cba2068e-dd62-46bd-ba38-86a1cf01bc3f" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#cba2068e-dd62-46bd-ba38-86a1cf01bc3f-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="cba2068e-dd62-46bd-ba38-86a1cf01bc3f-test-list" class="list-group test-list collapse in">
                        <div id="c34d38f7-0096-489b-9db1-53af42987832" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#c34d38f7-0096-489b-9db1-53af42987832 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.remove();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="67f7ccaf-22bf-4a5f-8110-a9f9bbc0e696" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation remove rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#67f7ccaf-22bf-4a5f-8110-a9f9bbc0e696 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy(),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({}))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>)
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"remove"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="024683ff-8a43-4dc5-987b-6152f1221922" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.remove to remove the old document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#024683ff-8a43-4dc5-987b-6152f1221922 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({_id: <span class="hljs-string">"_id"</span>})),
                                remove: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">"_id"</span>)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.remove.calledWith({
                                    _id: <span class="hljs-string">"_id"</span>
                                }).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="492a6893-a77b-41d0-99bf-db3541d1583f" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the remove method</h3>
                <h5 class="suite-filename">/test/unit/methods/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="492a6893-a77b-41d0-99bf-db3541d1583f" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">2 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#492a6893-a77b-41d0-99bf-db3541d1583f-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="492a6893-a77b-41d0-99bf-db3541d1583f-test-list" class="list-group test-list collapse in">
                        <div id="99cfa156-cbab-4b50-9e1b-6f1c777adfa7" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;documentId&#x60; is not a string
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#99cfa156-cbab-4b50-9e1b-6f1c777adfa7 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.remove().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `documentId` must be a string"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="3f3aa423-ec98-4756-a799-90efc24bb667" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if no document with the given id is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3f3aa423-ec98-4756-a799-90efc24bb667 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">404</span>,
                            message: <span class="hljs-string">"Document not found"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="3f891c96-93e5-4044-b626-2cff27c2c4bf" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#3f891c96-93e5-4044-b626-2cff27c2c4bf > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            )),
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d5a76b44-e213-4cdc-9fa6-9a532eb8e644" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if removing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d5a76b44-e213-4cdc-9fa6-9a532eb8e644 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                remove: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Remove error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Remove error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="b7c8d495-f4aa-4c6c-8dcf-60de04b7f9ea" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#b7c8d495-f4aa-4c6c-8dcf-60de04b7f9ea > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                remove: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.remove(collection, <span class="hljs-string">""</span>)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="94c52b4a-f1b0-4fe1-8d92-b94965b56d81" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The update method</h3>
                <h5 class="suite-filename">/test/unit/methods/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="94c52b4a-f1b0-4fe1-8d92-b94965b56d81" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">3 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#94c52b4a-f1b0-4fe1-8d92-b94965b56d81-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="94c52b4a-f1b0-4fe1-8d92-b94965b56d81-test-list" class="list-group test-list collapse in">
                        <div id="f4881e7f-67d2-4ff6-8089-8ac730dc1cbd" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#f4881e7f-67d2-4ff6-8089-8ac730dc1cbd > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> promise = methods.update();
                        promise.catch(R.always(<span class="hljs-literal">null</span>));
                        <span class="hljs-keyword">return</span> promise.should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="409ded20-75fb-4d27-b14b-059872291dbb" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should run validation update rules
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#409ded20-75fb-4d27-b14b-059872291dbb > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: sinon.spy(),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({}))
                            }
                        };
                        <span class="hljs-keyword">var</span> patches = [{
                            op: <span class="hljs-string">"add"</span>,
                            path: <span class="hljs-string">"/prop"</span>,
                            value: <span class="hljs-string">"value"</span>
                        }];
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches)
                            .catch(R.always(<span class="hljs-literal">null</span>))
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.runValidationRules.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.runValidationRules.firstCall.args[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">"update"</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="754a487e-5e71-4a26-8e89-4aa0318b5d26" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should call dbCollection.update with the updated document
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#754a487e-5e71-4a26-8e89-4aa0318b5d26 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always(BPromise.resolve({_id: <span class="hljs-string">"_id"</span>})),
                                update: sinon.stub().returns(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare({}, {a: <span class="hljs-number">1</span>});
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">"_id"</span>, patches)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                collection.dbCollection.update.called.should.equal(<span class="hljs-literal">true</span>);
                                collection.dbCollection.update.firstCall.args[<span class="hljs-number">0</span>].should.eql({
                                    _id: <span class="hljs-string">"_id"</span>
                                });
                                collection.dbCollection.update.firstCall.args[<span class="hljs-number">1</span>].should.eql({
                                    $set: {
                                        a: <span class="hljs-number">1</span>
                                    }
                                });
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="b1f40f16-1d3b-409f-ad18-11588eaa0ca9" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the update method</h3>
                <h5 class="suite-filename">/test/unit/methods/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="b1f40f16-1d3b-409f-ad18-11588eaa0ca9" class="suite-chart" width="50" height="50" data-total-passes="6" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">3 ms</li>
                    <li class="suite-summary-item tests">6</li>
                    <li class="suite-summary-item passed">6</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#b1f40f16-1d3b-409f-ad18-11588eaa0ca9-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="b1f40f16-1d3b-409f-ad18-11588eaa0ca9-test-list" class="list-group test-list collapse in">
                        <div id="4de26203-ca81-4e6e-825b-d2bc89f1aaac" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;documentId&#x60; is not a string
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4de26203-ca81-4e6e-825b-d2bc89f1aaac > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.update().should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"First argument `documentId` must be a string"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="cf54fee0-27c1-4450-9658-5ebcbb3c93ba" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if the remote argument &#x60;patches&#x60; is not an array of patches
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#cf54fee0-27c1-4450-9658-5ebcbb3c93ba > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">return</span> methods.update(<span class="hljs-literal">null</span>, <span class="hljs-string">""</span>).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">400</span>,
                            message: <span class="hljs-string">"Second argument `patches` must be an array of JSON patches"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d04afc90-92d1-4c67-953f-eb54d5257bdb" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if no document with the given id is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d04afc90-92d1-4c67-953f-eb54d5257bdb > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">404</span>,
                            message: <span class="hljs-string">"Document not found"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="f3773608-02f8-4687-bb1c-b6485a6a8127" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if running validation rules fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#f3773608-02f8-4687-bb1c-b6485a6a8127 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.reject(
                                <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Error message"</span>)
                            )),
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">499</span>,
                            message: <span class="hljs-string">"Error message"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="fb4e6f53-f1d0-403e-a66f-d458b3864e34" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected if updating fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#fb4e6f53-f1d0-403e-a66f-d458b3864e34 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                update: R.always(BPromise.reject(
                                    <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">599</span>, <span class="hljs-string">"Update error"</span>)
                                ))
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches).should.be.rejectedWith(MW.Error, {
                            code: <span class="hljs-number">599</span>,
                            message: <span class="hljs-string">"Update error"</span>
                        });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="422ef4e5-0e65-4b95-966c-9d80c73c845a" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be resolved with null if nothing fails
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#422ef4e5-0e65-4b95-966c-9d80c73c845a > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            runValidationRules: R.always(BPromise.resolve()),
                            dbCollection: {
                                findOne: R.always({}),
                                update: R.always(BPromise.resolve())
                            }
                        };
                        <span class="hljs-keyword">return</span> methods.update(collection, <span class="hljs-string">""</span>, patches)
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> </span>{
                                (result === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="041b1a20-ed76-4300-b226-ff42d8279783" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The applyPatches function</h3>
                <h5 class="suite-filename">/test/unit/lib/apply-patches.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="041b1a20-ed76-4300-b226-ff42d8279783" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#041b1a20-ed76-4300-b226-ff42d8279783-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="041b1a20-ed76-4300-b226-ff42d8279783-test-list" class="list-group test-list collapse in">
                        <div id="48ed50e7-01e9-4368-82a7-cd60823ddbc2" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should apply the supplied set of patches to the supplied object
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#48ed50e7-01e9-4368-82a7-cd60823ddbc2 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> oldObj = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> newObj = {
                            a: <span class="hljs-number">2</span>
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare(oldObj, newObj);
                        <span class="hljs-keyword">var</span> patchedObj = applyPatches(oldObj, patches);
                        patchedObj.should.eql(newObj);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="acb8bbb6-3ea1-45db-9a6a-8bb31fb43d64" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not mutate the object to which it applies patches
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#acb8bbb6-3ea1-45db-9a6a-8bb31fb43d64 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> oldObj = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> oldObjClone = {
                            a: <span class="hljs-number">1</span>
                        };
                        <span class="hljs-keyword">var</span> newObj = {
                            a: <span class="hljs-number">2</span>
                        };
                        <span class="hljs-keyword">var</span> patches = jp.compare(oldObj, newObj);
                        applyPatches(oldObj, patches);
                        oldObj.should.eql(oldObjClone);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="d98c9bf1-9c3a-4d4e-b019-ce2700900684" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The argMatches function</h3>
                <h5 class="suite-filename">/test/unit/lib/arg-matches.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="d98c9bf1-9c3a-4d4e-b019-ce2700900684" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#d98c9bf1-9c3a-4d4e-b019-ce2700900684-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="d98c9bf1-9c3a-4d4e-b019-ce2700900684-test-list" class="list-group test-list collapse in">
                        <div id="591e8769-bcd3-4466-baa9-200d3a80e77f" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return true the argument is of the correct type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#591e8769-bcd3-4466-baa9-200d3a80e77f > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">argMatches(t.Str, <span class="hljs-string">"I'm a string"</span>).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="4097de22-9551-44d2-af9b-2ffd8c5e20de" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should throw an MW.Error if the argument is of the incorrect type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4097de22-9551-44d2-af9b-2ffd8c5e20de > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">argMatches(t.Num, <span class="hljs-string">"I'm a string, not a number"</span>).should.equal(<span class="hljs-literal">false</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="1adf6777-ff56-4eb5-b19c-3dc36ceb1bc4" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The ensure function</h3>
                <h5 class="suite-filename">/test/unit/lib/ensure.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="1adf6777-ff56-4eb5-b19c-3dc36ceb1bc4" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#1adf6777-ff56-4eb5-b19c-3dc36ceb1bc4-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="1adf6777-ff56-4eb5-b19c-3dc36ceb1bc4-test-list" class="list-group test-list collapse in">
                        <div id="8ba750db-d06c-4352-93ff-004eecdaa69a" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not throw if the condition is truthy
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#8ba750db-d06c-4352-93ff-004eecdaa69a > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> peacefulFella = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            ensure(error, <span class="hljs-literal">true</span>);
                        };
                        peacefulFella.should.not.throw();</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="1b1bc9ec-92c9-49de-acdc-42bfc07faf77" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should throw if the condition is falsy
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#1b1bc9ec-92c9-49de-acdc-42bfc07faf77 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> troublemaker = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            ensure(error, <span class="hljs-literal">false</span>);
                        };
                        troublemaker.should.throw(<span class="hljs-built_in">Error</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="f3e1d07b-bba4-4d34-a840-26a9552db720" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The getOldDocument function</h3>
                <h5 class="suite-filename">/test/unit/lib/get-old-document.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="f3e1d07b-bba4-4d34-a840-26a9552db720" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#f3e1d07b-bba4-4d34-a840-26a9552db720-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="f3e1d07b-bba4-4d34-a840-26a9552db720-test-list" class="list-group test-list collapse in">
                        <div id="0e8c2b47-506b-4a5f-9152-007642c444ce" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should return a promise
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#0e8c2b47-506b-4a5f-9152-007642c444ce > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.a.Promise;</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="c9cdae59-26e6-4355-ab39-f6a8f7583af5" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The promise returned by the getOldDocument function</h3>
                <h5 class="suite-filename">/test/unit/lib/get-old-document.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="c9cdae59-26e6-4355-ab39-f6a8f7583af5" class="suite-chart" width="50" height="50" data-total-passes="2" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">2</li>
                    <li class="suite-summary-item passed">2</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#c9cdae59-26e6-4355-ab39-f6a8f7583af5-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="c9cdae59-26e6-4355-ab39-f6a8f7583af5-test-list" class="list-group test-list collapse in">
                        <div id="d78d6769-5e4f-49b7-91bd-7da43e7d410e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be fulfilled if a document is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d78d6769-5e4f-49b7-91bd-7da43e7d410e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always({})
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.fulfilledWith({});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="5da92f13-cb0d-4e1c-8d37-2b4edd3a3660" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be rejected with a MW.Error if no document is found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#5da92f13-cb0d-4e1c-8d37-2b4edd3a3660 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> collection = {
                            dbCollection: {
                                findOne: R.always(<span class="hljs-literal">null</span>)
                            }
                        };
                        <span class="hljs-keyword">return</span> getOldDocument(collection).should.be.rejectedWith(MW.Error);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="1f94b530-eb51-4e86-b11c-0ab00f9d3a85" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The PatchesType object</h3>
                <h5 class="suite-filename">/test/unit/lib/patches-type.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="1f94b530-eb51-4e86-b11c-0ab00f9d3a85" class="suite-chart" width="50" height="50" data-total-passes="3" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">1 ms</li>
                    <li class="suite-summary-item tests">3</li>
                    <li class="suite-summary-item passed">3</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#1f94b530-eb51-4e86-b11c-0ab00f9d3a85-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="1f94b530-eb51-4e86-b11c-0ab00f9d3a85-test-list" class="list-group test-list collapse in">
                        <div id="7aeb5a4b-a28d-4321-87bc-651804799122" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should be a tcomb type
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#7aeb5a4b-a28d-4321-87bc-651804799122 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small">t.Type.is(PatchesType).should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d94c0487-45d9-4a25-a618-1100a6f68cb7" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should match valid JSON patches, unless they&#x27;re an empty array
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d94c0487-45d9-4a25-a618-1100a6f68cb7 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">1 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> validPatches_0 = [{
                            op: <span class="hljs-string">"add"</span>,
                            path: <span class="hljs-string">"/prop"</span>,
                            value: <span class="hljs-string">"value"</span>
                        }];
                        <span class="hljs-keyword">var</span> validPatches_1 = jp.compare({a: <span class="hljs-number">1</span>}, {b: <span class="hljs-number">1</span>});
                        t.validate(validPatches_0, PatchesType).isValid().should.equal(<span class="hljs-literal">true</span>);
                        t.validate(validPatches_1, PatchesType).isValid().should.equal(<span class="hljs-literal">true</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="fd972c26-e731-47a1-bcbd-c28e0294c38f" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should not match invalid JSON patches and empty arrays
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#fd972c26-e731-47a1-bcbd-c28e0294c38f > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> invalidPatches_0 = [{a: <span class="hljs-number">2</span>}];
                        t.validate(invalidPatches_0, PatchesType).isValid().should.equal(<span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">var</span> invalidPatches_1 = [];
                        t.validate(invalidPatches_1, PatchesType).isValid().should.equal(<span class="hljs-literal">false</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="b53f103f-bb44-4da0-a384-2fcea03d549e" class="suite has-tests has-passed">
                <h3 class="suite-title">Unit suite - The randomId function</h3>
                <h5 class="suite-filename">/test/unit/lib/random-id.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="b53f103f-bb44-4da0-a384-2fcea03d549e" class="suite-chart" width="50" height="50" data-total-passes="1" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">0 ms</li>
                    <li class="suite-summary-item tests">1</li>
                    <li class="suite-summary-item passed">1</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#b53f103f-bb44-4da0-a384-2fcea03d549e-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="b53f103f-bb44-4da0-a384-2fcea03d549e-test-list" class="list-group test-list collapse in">
                        <div id="7291d138-85ea-4dbb-9852-97ffa3e46d50" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              should generate a random 16-bytes string (32 characters long)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#7291d138-85ea-4dbb-9852-97ffa3e46d50 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">0 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> string = randomId();
                        string.should.be.a.String;
                        string.length.should.equal(<span class="hljs-number">32</span>);</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="72a527a3-bb7c-42da-87b6-fe053bdf5c43" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Inserting a document</h3>
                <h5 class="suite-filename">/test/integration/insert.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="72a527a3-bb7c-42da-87b6-fe053bdf5c43" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">85 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#72a527a3-bb7c-42da-87b6-fe053bdf5c43-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="72a527a3-bb7c-42da-87b6-fe053bdf5c43-test-list" class="list-group test-list collapse in">
                        <div id="e1252e1b-3697-4c54-847a-220870d5cde1" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#e1252e1b-3697-4c54-847a-220870d5cde1 > .test-code.collapse">Code</button>
                              <span class="test-duration medium">61 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [<span class="hljs-string">"myDocument"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `newDocument` must be an object"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="0cd05216-528d-4b41-be8b-3efde69a9ed6" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#0cd05216-528d-4b41-be8b-3efde69a9ed6 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">9 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="4e378fb1-5fe6-4da0-a90c-8f54c58e999b" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4e378fb1-5fe6-4da0-a90c-8f54c58e999b > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a96501c9-da12-4ccf-8394-14ab9dbe9b33" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              inserting the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a96501c9-da12-4ccf-8394-14ab9dbe9b33 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">6 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                insert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> cursor = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>).find({});
                                <span class="hljs-keyword">return</span> BPromise.promisify(cursor.count, cursor)();
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(count)</span> </span>{
                                count.should.equal(<span class="hljs-number">1</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="4fd2abbd-ed1d-4c4f-980c-16787ad55fb3" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              automatic assignment of a string _id
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#4fd2abbd-ed1d-4c4f-980c-16787ad55fb3 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">6 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/insert"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({});
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                element._id.should.be.a.String;
                                element._id.length.should.equal(<span class="hljs-number">32</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="4836db2d-f43b-43c7-b3f5-07323c98e19f" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Removing a document</h3>
                <h5 class="suite-filename">/test/integration/remove.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="4836db2d-f43b-43c7-b3f5-07323c98e19f" class="suite-chart" width="50" height="50" data-total-passes="5" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">20 ms</li>
                    <li class="suite-summary-item tests">5</li>
                    <li class="suite-summary-item passed">5</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#4836db2d-f43b-43c7-b3f5-07323c98e19f-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="4836db2d-f43b-43c7-b3f5-07323c98e19f-test-list" class="list-group test-list collapse in">
                        <div id="35bb7146-9dee-4a56-bf97-adfe314e24d4" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#35bb7146-9dee-4a56-bf97-adfe314e24d4 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [{}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `documentId` must be a string"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d7f78845-4ac3-4d4a-a845-3745924b36dc" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              404 on document not found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d7f78845-4ac3-4d4a-a845-3745924b36dc > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"idNotInDatabase"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">404</span>)
                            .expect({error: <span class="hljs-string">"Document not found"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="e5453e76-8ea5-49ff-abee-056186715d54" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#e5453e76-8ea5-49ff-abee-056186715d54 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">6 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="9876a7c8-6264-47f8-988f-55bb78690401" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#9876a7c8-6264-47f8-988f-55bb78690401 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="f01242bb-efff-4382-b573-8ee79cd5f476" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              removing the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#f01242bb-efff-4382-b573-8ee79cd5f476 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/remove"</span>, params: [<span class="hljs-string">"elementId"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({
                                    _id: <span class="hljs-string">"elementId"</span>
                                });
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                (element === <span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
            <section class="suite-wrap">
              <div id="419e8c14-28f1-423c-adc2-c3fafeb08922" class="suite has-tests has-passed">
                <h3 class="suite-title">Integration suite - Updating a document</h3>
                <h5 class="suite-filename">/test/integration/update.js</h5>
                <!-- Suite Chart -->
                <div class="suite-chart-wrap">
                  <canvas id="419e8c14-28f1-423c-adc2-c3fafeb08922" class="suite-chart" width="50" height="50" data-total-passes="6" data-total-failures="0" data-total-pending="0" data-total-skipped="0"></canvas>
                </div>
                <div class="suite-data-wrap">
                  <!-- Suite Summary -->
                  <ul class="suite-summary list-unstyled">
                    <li class="suite-summary-item duration">22 ms</li>
                    <li class="suite-summary-item tests">6</li>
                    <li class="suite-summary-item passed">6</li>
                    <li class="suite-summary-item failed">0</li>
                    <li class="suite-summary-item pending">0</li>
                  </ul>
                  <!-- Test Info -->
                  <div class="suite-test-wrap">
                    <div class="suite-test-header" data-toggle="collapse" data-target="#419e8c14-28f1-423c-adc2-c3fafeb08922-test-list">
                      <h4 class="suite-test-header-title">Tests</h4>
                    </div>
                    <div id="419e8c14-28f1-423c-adc2-c3fafeb08922-test-list" class="list-group test-list collapse in">
                        <div id="ffe5db91-6e29-4a97-9c5f-4c689b285dc2" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments [first argument]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#ffe5db91-6e29-4a97-9c5f-4c689b285dc2 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [{}, <span class="hljs-string">"previous-arg-not-a-string"</span>]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"First argument `documentId` must be a string"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="a60da70e-fe0f-4b2b-a176-62b94e5b0080" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              400 on calling the api with the wrong arguments [second argument]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#a60da70e-fe0f-4b2b-a176-62b94e5b0080 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">2 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"second-arg-not-array-of-patches"</span>, {}]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">400</span>)
                            .expect({error: <span class="hljs-string">"Second argument `patches` must be an array of JSON patches"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="0d960033-d60e-470d-abca-aac5413eae6e" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              404 on document not found
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#0d960033-d60e-470d-abca-aac5413eae6e > .test-code.collapse">Code</button>
                              <span class="test-duration fast">3 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"idNotInDatabase"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">404</span>)
                            .expect({error: <span class="hljs-string">"Document not found"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="d88a2559-b695-498a-b815-c4e02cd74752" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [throwing]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#d88a2559-b695-498a-b815-c4e02cd74752 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">4 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">499</span>, <span class="hljs-string">"Validation error"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">499</span>)
                            .expect({error: <span class="hljs-string">"Validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="700d5802-51fc-4328-8d14-0fd46a669243" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              error if validation rules fail [returning an eventually rejected promise]
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#700d5802-51fc-4328-8d14-0fd46a669243 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">5 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements.addValidationRules({
                            update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                <span class="hljs-keyword">return</span> BPromise.reject(<span class="hljs-keyword">new</span> MW.Error(<span class="hljs-number">489</span>, <span class="hljs-string">"Another validation error"</span>));
                            }
                        });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">489</span>)
                            .expect({error: <span class="hljs-string">"Another validation error"</span>});</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>            <div id="36ad132f-eba4-417e-9836-e149e00c8d67" class="list-group-item test passed">
                          <!-- Test Heading -->
                          <div class="test-heading">
                            <h4 class="test-title">
                              <span class="text-muted hidden"> it </span>
                              updating the document successful (after multiple validation rules pass)
                            </h4>
                            <div class="pull-right">
                              <button class="btn btn-link btn-sm toggle-btn toggle-code collapsed" data-toggle="collapse" data-target="#36ad132f-eba4-417e-9836-e149e00c8d67 > .test-code.collapse">Code</button>
                              <span class="test-duration fast">5 ms</span>
                            </div>
                          </div>
                          <!-- Test Errors -->
                          <!-- Test Code -->
                          <div class="test-code collapse">
                            <pre><code class="hljs javascript small"><span class="hljs-keyword">var</span> Elements = <span class="hljs-keyword">new</span> Collection(mw, <span class="hljs-string">"elements"</span>);
                        Elements
                            .addValidationRules({
                                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                                }
                            })
                            .addValidationRules({
                                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newDocument)</span> </span>{
                                    <span class="hljs-keyword">return</span> BPromise.resolve(<span class="hljs-literal">null</span>);
                                }
                            });
                        <span class="hljs-keyword">var</span> app = express().use(<span class="hljs-string">"/"</span>, mw.getRouter());
                        <span class="hljs-keyword">return</span> request(app)
                            .post(<span class="hljs-string">"/"</span>)
                            .send({method: <span class="hljs-string">"/elements/update"</span>, params: [<span class="hljs-string">"elementId"</span>, patches]})
                            .expect(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-regexp">/json/</span>)
                            .expect(<span class="hljs-number">200</span>)
                            .expect({result: <span class="hljs-literal">null</span>})
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">var</span> collection = Elements.mw.db.collection(<span class="hljs-string">"elements"</span>);
                                <span class="hljs-keyword">return</span> BPromise.promisify(collection.findOne, collection)({
                                    _id: <span class="hljs-string">"elementId"</span>
                                });
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                                element.should.eql({
                                    _id: <span class="hljs-string">"elementId"</span>,
                                    prop: <span class="hljs-string">"value"</span>
                                });
                            });</code></pre>
                          </div>
                          <!-- Test Error Stack -->
                        </div>        </div>
                  </div>
                </div>
            
            
              </div>
            </section>
    </div>

    <footer>
      <div class="container">
        <p>Report generated by <a href="https://github.dowjones.net/grubera/mochawesome" target="_blank">mochawesome</a>.<br>Designed and built by <a href="https://github.com/adamgruber" target="_blank">adamgruber</a>. &copy;2015.</p>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="js/vendor.js"></script>
    <script src="js/mochawesome.js"></script>
  </body>
</html>
